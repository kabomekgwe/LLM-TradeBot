---
phase: 01-security-foundation
plan: 01
type: execute
---

<objective>
Implement immediate security wins: prevent credential leaks via git and improve secret masking.

Purpose: Quick, low-risk fixes that establish baseline security hygiene before tackling complex refactoring.
Output: `.gitignore` file protecting sensitive data, improved secret masking in configuration repr.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Codebase constraints:**
- Python 3.7+ codebase
- Uses dataclasses for configuration (`trading/config.py`)
- Current `__repr__` masking at `trading/config.py:199` masks only first 4 chars
- No `.gitignore` exists (high risk of committing secrets)

**From codebase analysis:**
- **Security concern 1**: No `.gitignore` - API keys in `.env` could be committed
- **Security concern 2**: `trading/config.py:199` only masks first 4 chars of secrets (insufficient)
- Recommended `.gitignore` entries: `.env`, `*.pem`, `*.key`, `__pycache__`, `.venv/`, `logs/`, `data/`

**Prior decisions:**
- Security foundation as Phase 1 (highest priority)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive .gitignore</name>
  <files>.gitignore</files>
  <action>
Create `.gitignore` at project root with entries to prevent committing sensitive files:

```
# Credentials and secrets
.env
.env.*
*.pem
*.key
*.p12
credentials.json
secrets/

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST

# Virtual environments
.venv/
venv/
ENV/
env/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# Project-specific
logs/
*.log
data/
*.db
*.sqlite
.trading_state.json
.trading_state_*.json

# OS
.DS_Store
Thumbs.db
```

This covers:
- Credential files (.env, *.pem, *.key) - CRITICAL for API key safety
- Python artifacts (__pycache__, *.pyc)
- Virtual environments (.venv/, venv/)
- Trading state files (may contain sensitive position data)
- Logs (may leak API interactions)
  </action>
  <verify>
- .gitignore file exists at project root
- Contains entries for .env, *.key, *.pem, .venv/, logs/, data/
- Run `git status` - sensitive files like .env should not appear in untracked files
  </verify>
  <done>
- .gitignore created with comprehensive security-focused entries
- Sensitive files excluded from git tracking
- Verification shows .env and other secrets won't be committed
  </done>
</task>

<task type="auto">
  <name>Task 2: Improve secret masking in config repr</name>
  <files>trading/config.py</files>
  <action>
Find the `__repr__` method at `trading/config.py:199` (currently masks only first 4 chars of secrets).

Replace insufficient masking with full masking:

**Current pattern** (from CONCERNS.md):
```python
def __repr__(self):
    return f"ExchangeConfig(secret={self.secret[:4]}...)"  # Only masks first 4
```

**New pattern** (full masking):
```python
def __repr__(self):
    # Fully mask API secrets - never expose even partial values
    masked_secret = "***REDACTED***" if self.secret else None
    masked_key = f"{self.api_key[:8]}..." if self.api_key else None  # Show first 8 chars of key (not secret)
    return f"ExchangeConfig(api_key={masked_key}, secret={masked_secret}, ...)"
```

**Why full masking**: API secrets (not keys) should be completely hidden. Keys can show first 8 chars for debugging (non-sensitive identifier), but secrets must be fully redacted. This prevents accidental leaks in logs, error messages, or debug output.

Apply this pattern to ANY configuration dataclass that contains sensitive fields (API keys, secrets, passwords, tokens).
  </action>
  <verify>
- Read `trading/config.py` - find modified `__repr__` methods
- Secrets are fully masked as "***REDACTED***"
- API keys show only first 8 chars (if needed for debugging)
- No partial secret exposure in repr output
  </verify>
  <done>
- All configuration dataclasses with sensitive fields have improved masking
- Secrets fully redacted in __repr__ output
- No accidental credential leaks possible via repr/str/logging
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `.gitignore` exists and contains all recommended entries
- [ ] `git status` shows no .env or credential files in untracked list
- [ ] `trading/config.py` repr methods fully mask secrets
- [ ] No partial secret values visible in any repr output
</verification>

<success_criteria>

- All tasks completed
- `.gitignore` prevents credential commits
- Secret masking fully protects API secrets
- No regressions (existing code still works)
  </success_criteria>

<output>
After completion, create `.planning/phases/01-security-foundation/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Quick Security Wins Summary

**[One-liner describing what shipped]**

## Accomplishments

- Created comprehensive `.gitignore` protecting credentials
- Improved secret masking in configuration dataclasses

## Files Created/Modified

- `.gitignore` - Comprehensive security-focused git ignore rules
- `trading/config.py` - Full secret masking in repr methods

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 01-02-PLAN.md (Atomic State Persistence)
</output>
